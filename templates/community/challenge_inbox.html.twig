{# templates/community/challenge_inbox.html.twig #}
{% extends "base.html.twig" %}

{% block title %}DÃ©fis ReÃ§us | MindForge{% endblock %}

{% block body %}
<div style="min-height: 100vh; background: linear-gradient(135deg, #f8f9fa 0%, #e8eaed 100%); padding: 2rem 1rem;">
    <div class="container">
        <!-- Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
            <h1 style="color: #2d3436; font-weight: 700; margin: 0;">
                <i class="fa fa-inbox" style="color: #6d5ce7;"></i> My Received Challenges
            </h1>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="{{ path('community_challenge_send') }}" class="btn btn-primary" style="padding: 10px 20px;">
                    <i class="fa fa-paper-plane"></i> Send Challenge
                </a>
                <a href="{{ path('community_challenge_outbox') }}" class="btn btn-secondary" style="padding: 10px 20px;">
                    <i class="fa fa-send"></i> Sent Challenges
                </a>
            </div>
        </div>

        <!-- Status Filter -->
        <div style="display: flex; gap: 0.75rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <a href="{{ path('community_challenge_inbox') }}" 
               style="padding: 8px 16px; border: 2px solid #6d5ce7; background: transparent; color: #6d5ce7; border-radius: 20px; cursor: pointer; text-decoration: none; font-weight: 500; transition: all 0.3s; {% if not filterStatus %}background: linear-gradient(135deg, #6d5ce7 0%, #5f3dc4 100%); color: white;{% endif %}"
               onmouseover="this.style.background='linear-gradient(135deg, #6d5ce7 0%, #5f3dc4 100%)'; this.style.color='white';"
               onmouseout="{% if not filterStatus %}{% else %}this.style.background='transparent'; this.style.color='#6d5ce7';{% endif %}">
                All
            </a>
            <a href="{{ path('community_challenge_inbox', {status: 'pending'}) }}" 
               style="padding: 8px 16px; border: 2px solid #fdcb6e; background: transparent; color: #fdcb6e; border-radius: 20px; cursor: pointer; text-decoration: none; font-weight: 500; transition: all 0.3s; {% if filterStatus == 'pending' %}background: #fdcb6e; color: #2d3436;{% endif %}"
               onmouseover="this.style.background='#fdcb6e'; this.style.color='#2d3436';"
               onmouseout="{% if filterStatus == 'pending' %}{% else %}this.style.background='transparent'; this.style.color='#fdcb6e';{% endif %}">
                Pending
            </a>
            <a href="{{ path('community_challenge_inbox', {status: 'accepted'}) }}" 
               style="padding: 8px 16px; border: 2px solid #00b894; background: transparent; color: #00b894; border-radius: 20px; cursor: pointer; text-decoration: none; font-weight: 500; transition: all 0.3s; {% if filterStatus == 'accepted' %}background: #00b894; color: white;{% endif %}"
               onmouseover="this.style.background='#00b894'; this.style.color='white';"
               onmouseout="{% if filterStatus == 'accepted' %}{% else %}this.style.background='transparent'; this.style.color='#00b894';{% endif %}">
                Accepted
            </a>
            <a href="{{ path('community_challenge_inbox', {status: 'rejected'}) }}" 
               style="padding: 8px 16px; border: 2px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 20px; cursor: pointer; text-decoration: none; font-weight: 500; transition: all 0.3s; {% if filterStatus == 'rejected' %}background: #ff6b6b; color: white;{% endif %}"
               onmouseover="this.style.background='#ff6b6b'; this.style.color='white';"
               onmouseout="{% if filterStatus == 'rejected' %}{% else %}this.style.background='transparent'; this.style.color='#ff6b6b';{% endif %}">
                Rejected
            </a>
        </div>

        <!-- Flash Messages -->
        {% if app.flashes %}
            {% for type, messages in app.flashes %}
                {% for message in messages %}
                    <div class="alert alert-{{ type == 'error' ? 'danger' : 'success' }}" style="margin-bottom: 1.5rem;">
                        <i class="fa fa-{{ type == 'error' ? 'exclamation-circle' : 'check-circle' }}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endfor %}
        {% endif %}

        <!-- Challenges List -->
        <div style="display: grid; gap: 1.5rem;">
            {% if tasks|length == 0 %}
                <!-- Empty State -->
                <div class="card" style="text-align: center; padding: 3rem; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);">
                    <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">ðŸ“­</div>
                    <p style="color: #636e72; font-size: 1.1rem; margin: 0;">You don't have any challenges yet.</p>
                    <a href="{{ path('community_challenge_send') }}" class="btn btn-primary" style="margin-top: 1.5rem; display: inline-block; padding: 10px 24px;">
                        <i class="fa fa-paper-plane"></i> Receive Challenges
                    </a>
                </div>
            {% else %}
                {% for task in tasks %}
                    <div class="card" style="border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); border-left: 4px solid {% if task.status == 'pending' %}#fdcb6e{% elseif task.status == 'accepted' %}#00b894{% elseif task.status == 'rejected' %}#ff6b6b{% else %}#6d5ce7{% endif %};">
                        <div class="card-body">
                            <!-- Challenge Header -->
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                                <div style="flex: 1;">
                                    <h4 style="color: #2d3436; margin: 0 0 0.5rem 0; font-weight: 600;">{{ task.title }}</h4>
                                    <p style="color: #636e72; margin: 0; font-size: 0.95rem;">
                                        <i class="fa fa-user"></i> From: <strong>{{ task.sharedBy.email }}</strong>
                                    </p>
                                </div>
                                <span class="badge badge-{{ task.status }}" style="padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; {% if task.status == 'pending' %}background-color: rgba(253, 203, 110, 0.15); color: #fdcb6e;{% elseif task.status == 'accepted' %}background-color: rgba(0, 184, 148, 0.15); color: #00b894;{% elseif task.status == 'rejected' %}background-color: rgba(255, 107, 107, 0.15); color: #ff6b6b;{% else %}background-color: rgba(109, 92, 231, 0.15); color: #6d5ce7;{% endif %} white-space: nowrap;">
                                    {{ task.status|upper }}
                                </span>
                            </div>

                            <!-- Challenge Description -->
                            {% if task.description %}
                                <div style="background-color: #f8f9fa; padding: 1rem; border-radius: 8px; margin: 1rem 0; color: #636e72; line-height: 1.6;">
                                    {{ task.description }}
                                </div>
                            {% endif %}

                            <!-- Metadata -->
                            <div style="display: flex; gap: 2rem; font-size: 0.9rem; color: #95a5a6; margin: 1rem 0; border-top: 1px solid #e8eaed; padding-top: 1rem;">
                                <span><i class="fa fa-calendar"></i> Received: {{ task.createdAt|date('d/m/Y H:i') }}</span>
                                {% if task.respondedAt %}
                                    <span><i class="fa fa-check"></i> Responded: {{ task.respondedAt|date('d/m/Y H:i') }}</span>
                                {% endif %}
                            </div>

                            <!-- Actions -->
                            {% if task.status == 'pending' %}
                                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                    <form method="POST" action="{{ path('community_challenge_respond', {id: task.id}) }}" style="display: inline; flex: 1;">
                                        <input type="hidden" name="response" value="accepted">
                                        <button type="submit" class="btn btn-success" style="width: 100%; padding: 10px 20px; text-align: center;">
                                            <i class="fa fa-check"></i> Accept
                                        </button>
                                    </form>
                                    <form method="POST" action="{{ path('community_challenge_respond', {id: task.id}) }}" style="display: inline; flex: 1;">
                                        <input type="hidden" name="response" value="rejected">
                                        <button type="submit" class="btn btn-danger" style="width: 100%; padding: 10px 20px; text-align: center;">
                                            <i class="fa fa-times"></i> Reject
                                        </button>
                                    </form>
                                </div>
                            {% else %}
                                <div style="padding: 1rem; background-color: rgba(109, 92, 231, 0.08); border-radius: 8px; margin-top: 1rem; color: #6d5ce7; font-weight: 500;">
                                    <i class="fa fa-info-circle"></i> Your response: <strong>{{ task.status|upper }}</strong>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block stylesheets %}{% endblock %}
