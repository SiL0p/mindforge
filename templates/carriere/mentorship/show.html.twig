{% extends 'base.html.twig' %}

{% block title %}Mentorship Details{% endblock %}

{% block hero %}
<div class="hero-area section">
	<div class="bg-image bg-parallax overlay" style="background-image:url({{ asset('user/img/page-background.jpg') }})"></div>
	<div class="container">
		<div class="row">
			<div class="col-md-10 col-md-offset-1 text-center">
				<ul class="hero-area-tree">
					<li><a href="{{ path('app_home') }}">Home</a></li>
					<li><a href="{{ path('app_carriere_mentorship_index') }}">My Mentorships</a></li>
					<li>Details</li>
				</ul>
				<h1 class="white-text">Mentorship Details</h1>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block content %}
<div class="section">
	<div class="container">
		<div class="row">

			<!-- Main Content -->
			<div class="col-md-8">
				<div style="background: #fff; padding: 30px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
					<h3 style="margin-top: 0;">Mentorship Information</h3>

					<div style="margin-bottom: 15px;">
						<strong>Status:</strong>
						{% if mentorship.status == 'pending' %}
							<span class="label label-warning">Pending</span>
						{% elseif mentorship.status == 'active' %}
							<span class="label label-success">Active</span>
						{% elseif mentorship.status == 'completed' %}
							<span class="label label-info">Completed</span>
						{% elseif mentorship.status == 'cancelled' %}
							<span class="label label-danger">Cancelled</span>
						{% endif %}
					</div>

					<p><strong>Student:</strong> {{ mentorship.student.email }}</p>
					<p><strong>Mentor:</strong> {{ mentorship.mentor.email }}</p>
					{% if mentorship.company %}
						<p><strong>Company:</strong> {{ mentorship.company.name }}</p>
					{% endif %}
					<p class="text-muted"><i class="fa fa-calendar"></i> Started: {{ mentorship.startedAt|date('F d, Y \\a\\t H:i') }}</p>
					{% if mentorship.endedAt %}
						<p class="text-muted"><i class="fa fa-calendar-check-o"></i> Ended: {{ mentorship.endedAt|date('F d, Y \\a\\t H:i') }}</p>
					{% endif %}

					<hr>

					<!-- Notes Timeline -->
					<h4>Notes & Updates</h4>
					{% if mentorship.notesArray|length > 0 %}
						<div style="margin-top: 20px;">
							{% for note in mentorship.notesArray %}
								<div style="background: #f9f9f9; padding: 15px; border-radius: 4px; margin-bottom: 15px; border-left: 3px solid #6C3BAA;">
									<p style="margin: 0; font-size: 13px; color: #666;">
										<strong>{{ note.author }}</strong>
										<span class="text-muted">- {{ note.timestamp }}</span>
									</p>
									<p style="margin: 10px 0 0 0; line-height: 1.6;">{{ note.content }}</p>
								</div>
							{% endfor %}
						</div>
					{% else %}
						<p class="text-muted"><em>No notes yet</em></p>
					{% endif %}

					<!-- Add Note Form (only if active) -->
					{% if mentorship.status == 'active' %}
						<hr>
						<h4>Add Note</h4>
						{{ form_start(note_form, {'action': path('app_carriere_mentorship_add_note', {id: mentorship.id}), 'method': 'POST'}) }}
							<div class="form-group">
								{{ form_widget(note_form.content, {'attr': {'class': 'input', 'rows': 4, 'placeholder': 'Write your note here...'}}) }}
								{{ form_errors(note_form.content) }}
							</div>
							<button type="submit" class="main-button icon-button">
								<i class="fa fa-plus"></i> Add Note
							</button>
						{{ form_end(note_form) }}
					{% endif %}

					<hr>

					<!-- Action Buttons -->
					<div>
						<a href="{{ path('app_carriere_mentorship_index') }}" class="main-button icon-button">
							<i class="fa fa-arrow-left"></i> Back to My Mentorships
						</a>

						{% if mentorship.status == 'pending' and mentorship.isMentor(app.user) %}
							<form method="post" action="{{ path('app_carriere_mentorship_accept', {id: mentorship.id}) }}"
								  style="display: inline; margin-left: 15px;">
								<input type="hidden" name="_token" value="{{ csrf_token('accept' ~ mentorship.id) }}">
								<button type="submit" class="main-button icon-button" style="background: #5cb85c;">
									<i class="fa fa-check"></i> Accept Mentorship
								</button>
							</form>
							<form method="post" action="{{ path('app_carriere_mentorship_cancel', {id: mentorship.id}) }}"
								  style="display: inline; margin-left: 10px;"
								  onsubmit="return confirm('Are you sure you want to decline this mentorship request?');">
								<input type="hidden" name="_token" value="{{ csrf_token('cancel' ~ mentorship.id) }}">
								<button type="submit" class="main-button icon-button" style="background: #d9534f;">
									<i class="fa fa-times"></i> Decline
								</button>
							</form>
						{% endif %}

						{% if mentorship.status == 'active' %}
							<form method="post" action="{{ path('app_carriere_mentorship_complete', {id: mentorship.id}) }}"
								  style="display: inline; margin-left: 15px;"
								  onsubmit="return confirm('Are you sure you want to mark this mentorship as completed?');">
								<input type="hidden" name="_token" value="{{ csrf_token('complete' ~ mentorship.id) }}">
								<button type="submit" class="main-button icon-button" style="background: #5bc0de;">
									<i class="fa fa-check-circle"></i> Mark as Completed
								</button>
							</form>
							<form method="post" action="{{ path('app_carriere_mentorship_cancel', {id: mentorship.id}) }}"
								  style="display: inline; margin-left: 10px;"
								  onsubmit="return confirm('Are you sure you want to cancel this mentorship?');">
								<input type="hidden" name="_token" value="{{ csrf_token('cancel' ~ mentorship.id) }}">
								<button type="submit" class="main-button icon-button" style="background: #d9534f;">
									<i class="fa fa-times"></i> Cancel Mentorship
								</button>
							</form>
						{% endif %}
					</div>
				</div>
			</div>

			<!-- Sidebar -->
			<div class="col-md-4">
				<div class="widget">
					<h4 class="widget-title">Status Workflow</h4>
					<ul class="list-unstyled" style="line-height: 2.2;">
						<li>
							<span class="label label-warning">Pending</span>
							<p class="text-muted" style="font-size: 12px; margin: 5px 0 15px 0;">Waiting for mentor to accept</p>
						</li>
						<li>
							<span class="label label-success">Active</span>
							<p class="text-muted" style="font-size: 12px; margin: 5px 0 15px 0;">Mentorship is ongoing</p>
						</li>
						<li>
							<span class="label label-info">Completed</span>
							<p class="text-muted" style="font-size: 12px; margin: 5px 0 15px 0;">Mentorship has ended successfully</p>
						</li>
						<li>
							<span class="label label-danger">Cancelled</span>
							<p class="text-muted" style="font-size: 12px; margin: 5px 0 0 0;">Mentorship was cancelled</p>
						</li>
					</ul>
				</div>
			</div>

		</div>
	</div>
</div>
{% endblock %}
