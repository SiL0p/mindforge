{% extends 'workspace/module_base.html.twig' %}

{% block title %}Application Details{% endblock %}

{% block hero %}
<div class="hero-area section">
	<div class="bg-image bg-parallax overlay" style="background-image:url({{ asset('user/img/page-background.jpg') }})"></div>
	<div class="container">
		<div class="row">
			<div class="col-md-10 col-md-offset-1 text-center">
				<ul class="hero-area-tree">
					<li><a href="{{ path('app_home') }}">Home</a></li>
					{% if isCompanyView %}
						<li><a href="{{ path('app_carriere_application_my_company_applications') }}">Company Applications</a></li>
					{% else %}
						<li><a href="{{ path('app_carriere_application_my_applications') }}">My Applications</a></li>
					{% endif %}
					<li>Details</li>
				</ul>
				<h1 class="white-text">Application Details</h1>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block module_content %}
<div class="section">
	<div class="container">
		<div class="row">

			<!-- Main Content -->
			<div class="col-md-8">
				<div style="background: #fff; padding: 30px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
					<h3 style="margin-top: 0;">{{ application.opportunity.title }}</h3>
					<p style="font-size: 16px;">
						{% if application.opportunity.company %}
							<i class="fa fa-building"></i> <strong>{{ application.opportunity.company.name }}</strong>
						{% endif %}
					</p>

					{% if isCompanyView and application.user %}
						<div style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
							<h4 style="margin-top: 0; margin-bottom: 10px;"><i class="fa fa-user"></i> Applicant Information</h4>
							<p style="margin-bottom: 5px;"><strong>Email:</strong> {{ application.user.email }}</p>
							{% if application.user.profile %}
								{% set profile = application.user.profile %}
								{% if profile.firstName or profile.lastName %}
									<p style="margin-bottom: 5px;"><strong>Name:</strong> {{ profile.firstName }} {{ profile.lastName }}</p>
								{% endif %}
								{% if profile.phone %}
									<p style="margin-bottom: 5px;"><strong>Phone:</strong> {{ profile.phone }}</p>
								{% endif %}
							{% endif %}
						</div>
					{% endif %}

					<div style="margin-bottom: 15px;">
						<strong>Status:</strong>
						{% if application.status == 'pending' %}
							<span class="label label-warning">Pending</span>
						{% elseif application.status == 'accepted' %}
							<span class="label label-success">Accepted</span>
						{% elseif application.status == 'rejected' %}
							<span class="label label-danger">Rejected</span>
						{% elseif application.status == 'withdrawn' %}
							<span class="label label-default">Withdrawn</span>
						{% endif %}
					</div>

					<p class="text-muted"><i class="fa fa-calendar"></i> Applied: {{ application.appliedAt|date('F d, Y \\a\\t H:i') }}</p>

					<hr>

					{% if application.coverLetter %}
						<h4>Cover Letter</h4>
						<div style="white-space: pre-line; line-height: 1.8; background: #f9f9f9; padding: 20px; border-radius: 4px;">{{ application.coverLetter }}</div>
					{% else %}
						<p class="text-muted"><em>No cover letter submitted</em></p>
					{% endif %}

					<hr>

					<!-- Action Buttons -->
					<div>
						{% if isCompanyView %}
							{# Company View - Show company-specific actions #}
							<a href="{{ path('app_carriere_opportunity_show', {id: application.opportunity.id}) }}" class="main-button icon-button">
								<i class="fa fa-briefcase"></i> View Job Posting
							</a>
							<a href="{{ path('app_carriere_application_my_company_applications') }}" style="color: #6C3BAA; margin-left: 15px;">
								<i class="fa fa-arrow-left"></i> Back to Company Applications
							</a>
						{% else %}
							{# Applicant View - Show applicant-specific actions #}
							<a href="{{ path('app_carriere_opportunity_show', {id: application.opportunity.id}) }}" class="main-button icon-button">
								<i class="fa fa-briefcase"></i> View Opportunity
							</a>
							<a href="{{ path('app_carriere_application_my_applications') }}" style="color: #6C3BAA; margin-left: 15px;">
								<i class="fa fa-arrow-left"></i> Back to My Applications
							</a>

							{% if application.isPending %}
								<form method="post" action="{{ path('app_carriere_application_withdraw', {id: application.id}) }}"
									  style="display: inline; margin-left: 15px;"
									  onsubmit="return confirm('Are you sure you want to withdraw this application?');">
									<input type="hidden" name="_token" value="{{ csrf_token('withdraw' ~ application.id) }}">
									<button type="submit" class="main-button icon-button" style="background: #f0ad4e;">
										<i class="fa fa-times"></i> Withdraw Application
									</button>
								</form>
							{% endif %}
						{% endif %}
					</div>
				</div>
			</div>

			<!-- Sidebar -->
			<div class="col-md-4">
				<div class="widget">
					<h4 class="widget-title">Opportunity Details</h4>
					<ul class="list-unstyled" style="line-height: 2.2;">
						<li><strong>Type:</strong> {{ application.opportunity.type|capitalize }}</li>
						{% if application.opportunity.location %}
							<li><strong>Location:</strong> {{ application.opportunity.location }}</li>
						{% endif %}
						{% if application.opportunity.duration %}
							<li><strong>Duration:</strong> {{ application.opportunity.duration }}</li>
						{% endif %}
						{% if application.opportunity.deadline %}
							<li><strong>Deadline:</strong> {{ application.opportunity.deadline|date('M d, Y') }}</li>
						{% endif %}
					</ul>
					{% if application.opportunity.company %}
						<hr>
						<p><i class="fa fa-building"></i> <strong>{{ application.opportunity.company.name }}</strong></p>
						{% if application.opportunity.company.industry %}
							<p class="text-muted">{{ application.opportunity.company.industry }}</p>
						{% endif %}
					{% endif %}
				</div>
			</div>

		</div>
	</div>
</div>
{% endblock %}
